# 操作系统 作业 15

## 1
有一个 400 GB 的 SSD，页大小为 4K，它的擦写上限（P/E cycles）是 100,000 次，假设写均匀分布在所有的闪存页上，如果以每秒发 200,000 个写请求的速率写，请问多长时间这个 SSD 会被磨穿？

### 解

400 GB 的 SSD 总页数为

<p style="text-align:center;">
400 × 2<sup>20</sup> KB ÷ 4 KB = 100 × 2<sup>20</sup>
</p>

其写请求数量的上限为

<p style="text-align:center;">
100 × 2<sup>20</sup> × 100,000 = 10<sup>7</sup> × 2<sup>20</sup>
</p>

若每秒发 200,000 个写请求，那么其磨穿时间为

<p style="text-align:center;">
10<sup>7</sup> × 2<sup>20</sup> ÷ (200,000) = 100 × 2<sup>19</sup> = 52428800 秒 ≈ 14563.6 小时 ≈ 606 天
</p>

## 2
一个 SSD 每个块有 64 页，且它读一页的延迟是 25 微秒，写一页的延迟是 200 微秒，擦除一块的时间是 2 毫秒。如果它采用混合映射，分下面 3 种情况，计算回收一个块需要的时间。
1. Switch merge
2. Partial merge 且假设块中有效页为 50%
3. Full merge

写入和擦除可以同时进行

### 解

对 Switch merge，回收块只需要修改映射表信息，回收一个块只需要将其擦除，需要 2000 微秒。

对 Partial merge，回收块需要先将有效页读出（耗费 64 × 50% × 25 微秒 = 800 微秒），然后将之写回到数据块中（耗费 64 × 50% × 200 微秒 = 6400 微秒），写回同时擦除旧块（耗费 2000 微秒），总计耗费 800 + 6400 = 7200 微秒。

对 Full merge，回收块需将所有页读出（耗费 64 × 25 微秒 = 1600 微秒），然后将之写回到数据块中（耗费 64 × 200 = 12800 微秒），写回同时擦除旧块（耗费 2000 微秒），总计耗费 1600 + 12800 微秒。

## 3
假设一个 NFS 服务器使用 5 个磁盘构成的一个 RAID-5，每个条带为 64 KB，每个磁盘的寻道时间是 3 ms，旋转速度是 10,000 RPM，传输带宽是 200 MB/s。假设网络传输 4 KB 的延迟是 0.2ms，传输 1 MB 的延迟是 9 ms，请问:
1. 客户端用 NFS 一次读一个数据块（4 KB）的有效带宽是多少?
2. 客户端用 NFS 一次读 1 MB 数据的有效带宽是多少?

### 解

5 个磁盘构成的 RAID-5 系统，其读带宽是 5 × 200 MB/s = 1000 MB/s。

平均寻道时间为 0.5 × 60 / 10000 = 3 ms。

对一次读 1 个数据块的情况：
* 传输时间为 4 KB ÷ 1000 MB/s ≈ 0.004 ms
* 总消耗时间为 3 ms + 3 ms + 0.004 ms + 0.2 ms = 6.204 ms
* 有效带宽为 4 KB ÷ 6.204 ms ≈ 644.8 KB/s

对于一次读 1 MB 数据的情况：
* 传输时间为 1 MB ÷ 1000 MB/s = 1 ms
* 总消耗时间为 3 ms + 3 ms + 1 ms + 9 ms = 16 ms
* 有效带宽为 1 MB ÷ 16 ms = 62.5 MB/s

## 4

### 解



## 7
假设 WAFL 平均 1000 个操作的日志需要大约 1 MB 的 NVRAM 空间，如果一个 NFS 服务器的吞吐率是 3000 IOPS（即每秒 3000 次 I/O 操作），操作的读写比是 6:4，如果每 10 秒创建一个一致点的话，它需要多大 NVRAM？

### 解

在 10 秒中内，写操作的总数为

<p style="text-align:center;">
3000 × 10 × 0.4 = 12000
</p>

那么一个日志区域需要的空间为 12000 / 1000 = 12 MB。考虑到 WAFL 用两个日志区域轮流写，故 NVRAM 的空间需要 24 MB。